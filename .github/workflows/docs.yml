name: Docs

on:
  push:
    branches:
      - master
      - fix-docs-deployment
    tags:
      - '*'

env:
  CI: true
  NAME: deploy

jobs:
  deploy-docs:
    name: Deploy Docs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set Git User
        run: git config user.name "GitHub Actions" && git config user.email "actions@users.noreply.github.com"
      - uses: actions/setup-node@v2-beta
        with:
          node-version: '14'
      - name: Install Dependencies
        run: yarn install --frozen-lockfile
      - name: Set ENV
        # 'master' or 'v1.2.3'
        # https://github.com/ember-learn/ember-cli-addon-docs/issues/454#issuecomment-584129324
        # https://github.com/ember-learn/ember-cli-addon-docs/issues/437
        run: echo "::set-env name=ADDON_DOCS_VERSION_PATH::${GITHUB_REF##*/}"
      - name: Deploy docs with `ember-cli-deploy`
        run: yarn ember deploy production --verbose --activate
