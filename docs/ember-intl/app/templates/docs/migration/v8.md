# Migration from 7.0 to 8.0

## Breaking changes

### Minimum requirements

The following versions are supported when issues arise.

- Ember 4.12 and above
- Node 20 and above
- `@ember/test-helpers` 4.x and above


### Removed `app/formats.js` support

If you want reusable formats (these are optional), define them in `app/ember-intl.{js,ts}`. This file replaces `app/formats.js`.

```ts
/* app/ember-intl.ts */
import type { Formats } from 'ember-intl';

export const formats: Formats = {
  formatTime: {
    hhmmss: {
      hour: 'numeric',
      minute: 'numeric',
      second: 'numeric',
    },
  },
};
```

Note, the key names now match the names of the `intl` service methods (and the names of the helpers in strict mode):

| Usage in `intl` service | Key (before) | Key (after) |
|--|--|--|
| `formatDate()` | date | formatDate |
| `formatDateRange()` | dateTimeRange | formatDateRange |
| `formatNumber()` | number | formatNumber |
| `formatRelativeTime()` | relative | formatRelativeTime |
| `formatTime()` | time | formatTime |

<br>

Unlike with `app/formats.js`, `ember-intl` doesn't automatically (magically) read your formats. You use standard JavaScript to import and consume them. (You may see that formats can then live in any file. For standardization, `app/ember-intl.{js,ts}` is recommended.)

```ts
/* app/routes/application.ts */
import Route from '@ember/routing/route';
import { type Registry as Services, service } from '@ember/service';
import { formats } from 'my-app/ember-intl';

export default class ApplicationRoute extends Route {
  @service declare intl: Services['intl'];

  beforeModel() {
    this.intl.setFormats(formats);
    this.intl.setLocale(['en-us']);
  }
}
```

Since formats are set in the `application` route, your rendering and unit tests may need additional setup if they depend on a particular format.

```ts
import { formats } from 'my-app/ember-intl';

module('Integration | Component | my-component', function (hooks) {
  setupIntl(hooks, 'en-us');

  hooks.beforeEach(function () {
    const intl = this.owner.lookup('service:intl');
    intl.setFormats(formats);
  });
});
```


### Removed `/blueprints`

Until now, you could run `ember install ember-intl`, which caused files in `/blueprints` to create the files `config/ember-intl.js` (for overriding build options) and `translations/en-us.yaml` (for defining translations).

Using `ember install` to do a post-install is a remnant from classic Ember. It blurs the separation of concerns and isn't what `ember-intl` as a v2 addon should keep supporting. There are better ways to scaffold files (e.g. allow copy-pastes from the documentation site, run a codemod).

It also made sense to remove `/blueprints` for a few more reasons:

- The default values for build options should work well for most projects.
- Some may want to use `*.json` or another locale as their default choice.
- A smaller bundle size can be achieved. 

If you have a new project, you will need to create these files manually. If you want to override the build options, see [Build options](../advanced/build-options) for more information.


### Removed build options

Before `v6`, the number of build options that can be configured became too much. The more build options `ember-intl` allows, the harder it is to maintain code, standardize usage, and pave a way forward for Vite apps.

The following options have been removed.

- `excludeLocales`
- `includeLocales`
- `outputPath`
- `requiresTranslation`
- `stripEmptyTranslations`
- `verbose`

In `v8`, `ember-intl` will continue to support these options:

```ts
const defaultConfig = {
  errorOnMissingTranslations: false,
  errorOnNamedArgumentMismatch: false,
  fallbackLocale: undefined,
  inputPath: 'translations',
  publicOnly: false,
  wrapTranslationsWithNamespace: false,
};
```


### Stricter plural category validation

In `v7`, plural category validation only ran when the `verbose` build option was enabled. In `v8`, validation is always enabled and uses Unicode CLDR plural rules to ensure your translations use valid plural categories for each locale.

This means some messages that worked in `v7` will now cause build errors if they use invalid plural categories for their locale.

For example, Chinese and Japanese only support the `other` plural category. Using `one` will cause a validation error:

```json
// Before (v7) - worked but was incorrect
{
  "errors": "错误{count, plural, one {} other {}}"
}
```

```json
// After (v8) - correct
{
  "errors": "错误{count, plural, other {}}"
}
```

If you need to handle specific counts, use exact number matching instead of plural categories:

```json
{
  "errors": "错误{count, plural, =0 {无错误} =1 {1个错误} other {#个错误}}"
}
```

Valid plural categories by language:
- **English (en)**: `one`, `other`
- **Chinese (zh)**: `other` only
- **Japanese (ja)**: `other` only
- **Arabic (ar)**: `zero`, `one`, `two`, `few`, `many`, `other`
- **Polish (pl)**: `one`, `few`, `many`, `other`

See [Unicode CLDR plural rules](https://cldr.unicode.org/index/cldr-spec/plural-rules) for the complete list of plural categories per language.


### Removed loading of translations

For more information, see [V2 addon](#v2-addon) below.


### Renamed `formatRelative()` and `{{format-relative}}`

It was unclear from the name what exactly is being compared (relative to what?).

The method and the corresponding helper are called `formatRelativeTime()` and `{{format-relative-time}}` in `v8`.

```diff
// For *.{gjs,gts,js,ts} files
- this.intl.formatRelative(-1);
+ this.intl.formatRelativeTime(-1);
```

```diff
{{! For *.hbs files }}
<div>
-   Past: {{format-relative -1}}
+   Past: {{format-relative-time -1}}
</div>
```

```diff
// For *.{gjs,gts} files
- import { formatRelative } from 'ember-intl';
+ import { formatRelativeTime } from 'ember-intl';

<template>
  <div>
-     Past: {{formatRelative -1}}
+     Past: {{formatRelativeTime -1}}
  </div>
</template>
```


## Features

### V2 addon

`ember-intl` is now a v2 addon. It continues to provide the following, now pre-built:

- Helpers
- `intl` service
- Test helpers
- Native types for Glint
- Barrel file for templates in strict mode
- Template registry for templates in loose mode

What it no longer provides is the loading of translations. To ensure that all existing projects can use `ember-intl` as a v2 addon, the package `@ember-intl/v1-compat` has been created. It loads translations in an almost identical way as `ember-intl@v7` does.

Therefore, when you update `ember-intl` to `v8`, you may need to install `@ember-intl/v1-compat` as a development dependency.

- Apps need `@ember-intl/v1-compat`.
- V1 addons need it if their `dummy` app needs translations for documentation or testing.
- V2 addons don't need it.

Live reload didn't "just work" in Vite apps with `ember-intl@v7`, so `@ember-intl/v1-compat` (with the same implementation) doesn't fix the issue. The workarounds included [running `vite --force`](https://github.com/ember-intl/ember-intl/issues/1958#issue-2936842184) (to clear the cache) and [having one translation file per locale](https://github.com/ember-intl/ember-intl/issues/1958#issuecomment-2863762708).

There will be a separate package for loading translations in Vite apps. Until it's provided, you may use `@ember-intl/v1-compat` or a custom solution.
